steps:
    - name: 'gcr.io/cloud-builders/git'
      args: ['clone', 'https://github.com/${_GIT_USER}/${_REPO_NAME}']
    
    - name: 'gcr.io/cloud-builders/docker'
      args: ['build','-t', 'gcr.io/${_PROJECT}/${_CONTAINERNAME}:${_VERSION}','.']
    
    - name: 'gcr.io/cloud-builders/docker'
      args: ['push', 'gcr.io/${_PROJECT}/${_CONTAINERNAME}:${_VERSION}']    
    
    - name: 'gcr.io/cloud-builders/kubectl'
      args:
      - 'set'
      - 'image'
      - 'deployment/${_DEPLOYMENTNAME}'
      - '${_DEPLOYMENTNAME}=gcr.io/${_PROJECT}/${_CONTAINERNAME}:${_VERSION}'
      env:
      - 'CLOUDSDK_COMPUTE_ZONE=${_ZONE}'
      - 'CLOUDSDK_CONTAINER_CLUSTER=${_GKE_CLUSTER}'
  
  substitutions:
      _PROJECT: tough-bearing-259612
      _ZONE: europe-west1-b
      _GKE_CLUSTER: standard-cluster-1
  
      _DEPLOYMENTNAME: nginx-2
      _CONTAINERNAME: nginx-2
      _REPO_NAME: Bdeploy
      _GIT_USER: Maxe1
  
      _VERSION: v1.0
  